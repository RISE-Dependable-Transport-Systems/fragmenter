# AGENTS.md

## Quick Start

```bash
uv sync --all-groups          # Install dependencies
just lint && just test        # Validate changes
```

## Package manager

Use `uv` to manage dependencies, run scripts, and use the virtual environment, etc. Do not use `pip` or `python` directly.

## Project Structure

```text
src/fragmenter/
├── cli.py           # Typer CLI (entry point: fragmenter.cli:main)
├── config.py        # Pydantic settings
├── evaluation/      # RAG evaluation tools
├── rag/             # Core RAG pipeline (ingestion, inference, vector stores)
├── scraping/        # Web scraping utilities
├── tools/           # Additional tooling
└── utils/           # Logging and helpers
```

## Tech Stack

Python 3.12+ · Typer/Rich CLI · Pydantic settings · Loguru logging · LlamaIndex · ChromaDB · Ruff linting

## The RAG "database"

There is a subdirectory called data, this is the source ingested into the vector database. This contains three things:

- The source repo
- The autogenerated documentation from DeepWiki
- Additional resources such as papers, articles, etc.

## Linting & Formatting

Use `just lint` to run all pre-commit hooks (ruff, mypy, yamllint, actionlint, zizmor).

```bash
just lint              # Run all linters via pre-commit
just fmt               # Auto-format code
just check-all         # Lint + test
```

## Testing

```bash
just test              # Run unit tests (excludes integration)
just test-cov          # Run tests with coverage report
just test-integration  # Run integration tests
```

## Building & Publishing

```bash
just build             # Build sdist and wheel
just verify            # Inspect package contents
just test-install      # Test installation from wheel
just all               # Full pipeline: clean → install → lint → test → build → verify → install-test
```

## Tools

- Use pydantic-settings to handle paths and config.
- Use loguru for logging instead of print. Logging config setup is in src/fragmenter/utils/logging.py

## Deep Dive Docs

Read these when relevant to your task:

| File | When to Read |
|------|--------------|
| [agent_docs/architecture.md](agent_docs/architecture.md) | Data flow, ingestion/query pipelines, provider system |
| [agent_docs/ingestion.md](agent_docs/ingestion.md) | Parsing, chunking, incremental updates, vector store |
| [agent_docs/testing.md](agent_docs/testing.md) | Test strategy, mocking, running tests |

## Critical Files

- `rag/ingestion.py` — Orchestrates the full ingestion pipeline (load → parse → embed → store)
- `rag/parsers.py` — File-type-specific chunking with intelligent merge strategy
- `config.py` — Pydantic settings, LLM/embedding provider configuration
- `rag/pipeline.py` — IngestionPipeline factory (UPSERTS_AND_DELETE strategy)
- `rag/inference.py` — Query engine, index loading, code extraction
- `tools/init.py` — Copies `.env.example` → `.env` for onboarding
